<Window x:Class="OpenAsMenu.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OpenAsMenu"
        mc:Ignorable="d"
        Title="右键菜单配置工具" Height="700" Width="900"
        MinHeight="600" MinWidth="700"
        WindowStartupLocation="CenterScreen">

    <DockPanel>
        <!-- 菜单栏 -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="工具(_T)">
                <MenuItem x:Name="AddConfigMenuItem" Header="添加配置(_A)"
                          ToolTip="添加新的右键菜单配置"
                          Click="AddConfigButton_Click"/>
                <MenuItem x:Name="RemoveConfigMenuItem" Header="删除配置(_D)"
                          ToolTip="删除选中的配置"
                          Click="RemoveConfigButton_Click"/>
                <MenuItem x:Name="RefreshStatusMenuItem" Header="刷新状态(_R)"
                          ToolTip="刷新所有配置的状态"
                          Click="RefreshStatusButton_Click"/>
                <Separator/>
                <MenuItem x:Name="DisableWin11MenuMenuItem" Header="禁用Win11一级菜单(_W)"
                          ToolTip="切换到Win10样式的右键菜单（显示完整二级菜单）"
                          Click="DisableWin11MenuMenuItem_Click"/>
                <MenuItem x:Name="EnableWin11MenuMenuItem" Header="恢复Win11默认菜单(_E)"
                          ToolTip="恢复Win11默认的右键菜单样式"
                          Click="EnableWin11MenuMenuItem_Click"/>
                <Separator/>
                <MenuItem x:Name="CheckWin11StatusMenuItem" Header="检查菜单状态(_S)"
                          ToolTip="检查当前Win11右键菜单的状态"
                          Click="CheckWin11StatusMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="帮助(_H)">
                <MenuItem x:Name="AboutWin11MenuMenuItem" Header="关于(_A)"
                          ToolTip="关于右键菜单配置工具"
                          Click="AboutWin11MenuMenuItem_Click"/>
            </MenuItem>
        </Menu>

        <!-- 主内容区域 -->
        <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧面板 - 配置列表 -->
        <GroupBox Grid.Column="0" Header="配置列表">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!-- 配置列表 -->
                <ListBox x:Name="ConfigListBox"
                         Grid.Row="0"
                         SelectionChanged="ConfigListBox_SelectionChanged"
                         ScrollViewer.VerticalScrollBarVisibility="Hidden"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.CanContentScroll="False"
                         VirtualizingPanel.IsVirtualizing="False"
                         VerticalAlignment="Stretch"
                         HorizontalAlignment="Stretch"
                         BorderThickness="0"
                         Padding="5">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- 状态图标 -->
                                <Ellipse Grid.Row="0" Grid.Column="0" 
                                         Width="12" Height="12" 
                                         Margin="0,2,8,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Enabled}" Value="True">
                                                    <Setter Property="Fill" Value="#4CAF50"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Enabled}" Value="False">
                                                    <Setter Property="Fill" Value="#9E9E9E"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>

                                <!-- 配置名称 -->
                                <TextBlock Grid.Row="0" Grid.Column="1" 
                                           Text="{Binding Name}" 
                                           FontWeight="Medium" 
                                           FontSize="14"/>

                                <!-- 状态和范围 -->
                                <TextBlock Grid.Row="1" Grid.Column="1" 
                                           Margin="0,2,0,0" 
                                           FontSize="11" 
                                           Foreground="#6C757D">
                                    <Run Text="{Binding StatusText, Mode=OneWay}"/>
                                    <Run Text=" | "/>
                                    <Run Text="{Binding ScopeText, Mode=OneWay}"/>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </Grid>
        </GroupBox>

        <!-- 右侧面板 - 配置详情 -->
        <GroupBox x:Name="ConfigDetailsGroupBox" Grid.Column="1" Header="配置详情" Margin="10,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 配置表单 -->
                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <!-- 显示名称 -->
                        <Label Content="显示名称：" FontWeight="Medium" Margin="0,5,0,2"/>
                        <TextBox x:Name="NameTextBox"
                                 ToolTip="右键菜单中显示的名称"/>

                        <!-- 注册表键名 -->
                        <Label Content="注册表键名：" FontWeight="Medium" Margin="0,15,0,2"/>
                        <TextBox x:Name="RootTextBox"
                                 ToolTip="在注册表中使用的唯一标识符"/>

                        <!-- 程序路径 -->
                        <Label Content="程序路径：" FontWeight="Medium" Margin="0,15,0,2"/>
    <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="PathTextBox"
                                     Grid.Column="0"
                                     ToolTip="要启动的程序的完整路径"/>
                            <Button x:Name="BrowseButton"
                                    Grid.Column="1"
                                    Content="浏览..."
                                    Click="BrowseButton_Click"
                                    Margin="5,0,0,0"/>
                        </Grid>

                        <!-- 应用范围 -->
                        <Label Content="应用范围：" FontWeight="Medium" Margin="0,15,0,2"/>
                        <CheckBox x:Name="ForFilesCheckBox" 
                                  Content="应用于文件（否则应用于目录）"
                                  Margin="0,5"/>

                        <!-- 启用状态 -->
                        <Label Content="状态：" FontWeight="Medium" Margin="0,15,0,2"/>
                        <CheckBox x:Name="EnabledCheckBox" 
                                  Content="启用右键菜单"
                                  Margin="0,5"
                                  Checked="EnabledCheckBox_Checked"
                                  Unchecked="EnabledCheckBox_Unchecked"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- 操作按钮 -->
                <StackPanel Grid.Row="1"
                           Orientation="Horizontal"
                           HorizontalAlignment="Right"
                           Margin="10">
                    <Button x:Name="SaveButton"
                            Content="保存配置"
                            Click="SaveButton_Click"
                            ToolTip="仅保存配置信息，不更新右键菜单"
                            Margin="0,0,8,0"/>
                    <Button x:Name="ApplyButton"
                            Content="应用更改"
                            Click="ApplyButton_Click"
                            ToolTip="保存配置并更新右键菜单"
                            Margin="0,0,8,0"/>
                    <Button x:Name="TestPathButton"
                            Content="测试路径"
                            Click="TestPathButton_Click"/>
                </StackPanel>
            </Grid>
        </GroupBox>
        </Grid>
    </DockPanel>
</Window>
