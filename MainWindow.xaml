<Window x:Class="OpenAsMenu.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:OpenAsMenu"
        mc:Ignorable="d"
        Title="右键菜单配置工具" Height="700" Width="900"
        MinHeight="600" MinWidth="700"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <!-- 现代化样式资源 -->
        <Style x:Key="ModernButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#F8F9FA"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#E9ECEF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#DEE2E6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PrimaryButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#2196F3"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1976D2"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#1565C0"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DangerButtonStyle" TargetType="Button" BasedOn="{StaticResource ModernButtonStyle}">
            <Setter Property="Background" Value="#F44336"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#F44336"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#D32F2F"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#B71C1C"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Padding" Value="8"/>
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ScrollViewer x:Name="PART_ContentHost"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="#2196F3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernListBoxStyle" TargetType="ListBox">
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="White"/>
        </Style>

        <Style x:Key="ModernGroupBoxStyle" TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="#DEE2E6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Grid>
                            <Border Background="White" BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6"/>
                            <StackPanel>
                                <Border Background="#F8F9FA" CornerRadius="6,6,0,0" Padding="12,8">
                                    <ContentPresenter ContentSource="Header" TextElement.FontWeight="SemiBold"/>
                                </Border>
                                <ContentPresenter Margin="{TemplateBinding Padding}"/>
                            </StackPanel>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- 菜单栏 -->
        <Menu DockPanel.Dock="Top" Background="#F8F9FA" BorderBrush="#DEE2E6" BorderThickness="0,0,0,1">
            <MenuItem Header="工具(_T)">
                <MenuItem x:Name="DisableWin11MenuMenuItem" Header="禁用Win11一级菜单(_D)" 
                          ToolTip="切换到Win10样式的右键菜单（显示完整二级菜单）"
                          Click="DisableWin11MenuMenuItem_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="📋" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem x:Name="EnableWin11MenuMenuItem" Header="恢复Win11默认菜单(_E)" 
                          ToolTip="恢复Win11默认的右键菜单样式"
                          Click="EnableWin11MenuMenuItem_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="🔄" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem x:Name="CheckWin11StatusMenuItem" Header="检查菜单状态(_S)" 
                          ToolTip="检查当前Win11右键菜单的状态"
                          Click="CheckWin11StatusMenuItem_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="🔍" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="帮助(_H)">
                <MenuItem x:Name="AboutWin11MenuMenuItem" Header="关于Win11菜单切换(_A)" 
                          ToolTip="了解Win11右键菜单切换功能"
                          Click="AboutWin11MenuMenuItem_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="ℹ️" FontSize="14"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- 主内容区域 -->
        <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧面板 - 配置列表 -->
        <GroupBox Grid.Column="0" Header="配置列表" Style="{StaticResource ModernGroupBoxStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 配置列表 -->
                <ListBox x:Name="ConfigListBox" 
                         Grid.Row="0"
                         Style="{StaticResource ModernListBoxStyle}"
                         SelectionChanged="ConfigListBox_SelectionChanged"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         ScrollViewer.CanContentScroll="False"
                         VirtualizingPanel.IsVirtualizing="False"
                         MaxHeight="500"
                         VerticalAlignment="Stretch">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- 状态图标 -->
                                <Ellipse Grid.Row="0" Grid.Column="0" 
                                         Width="12" Height="12" 
                                         Margin="0,2,8,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Enabled}" Value="True">
                                                    <Setter Property="Fill" Value="#4CAF50"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Enabled}" Value="False">
                                                    <Setter Property="Fill" Value="#9E9E9E"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>

                                <!-- 配置名称 -->
                                <TextBlock Grid.Row="0" Grid.Column="1" 
                                           Text="{Binding Name}" 
                                           FontWeight="Medium" 
                                           FontSize="14"/>

                                <!-- 状态和范围 -->
                                <TextBlock Grid.Row="1" Grid.Column="1" 
                                           Margin="0,2,0,0" 
                                           FontSize="11" 
                                           Foreground="#6C757D">
                                    <Run Text="{Binding StatusText, Mode=OneWay}"/>
                                    <Run Text=" | "/>
                                    <Run Text="{Binding ScopeText, Mode=OneWay}"/>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- 按钮区域 -->
                <StackPanel Grid.Row="1" Margin="0,10,0,0">
                    <Button x:Name="AddConfigButton" 
                            Content="➕ 添加配置" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="AddConfigButton_Click"/>
                    <Button x:Name="RemoveConfigButton" 
                            Content="🗑️ 删除配置" 
                            Style="{StaticResource DangerButtonStyle}"
                            Click="RemoveConfigButton_Click"/>
                    <Button x:Name="RefreshStatusButton" 
                            Content="🔄 刷新状态" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="RefreshStatusButton_Click"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- 右侧面板 - 配置详情 -->
        <GroupBox x:Name="ConfigDetailsGroupBox" Grid.Column="1" Header="配置详情" Style="{StaticResource ModernGroupBoxStyle}" Margin="10,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 配置表单 -->
                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <!-- 显示名称 -->
                        <Label Content="显示名称：" FontWeight="Medium" Margin="0,5,0,2"/>
                        <TextBox x:Name="NameTextBox" 
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 ToolTip="右键菜单中显示的名称"/>

                        <!-- 注册表键名 -->
                        <Label Content="注册表键名：" FontWeight="Medium" Margin="0,15,0,2"/>
                        <TextBox x:Name="RootTextBox" 
                                 Style="{StaticResource ModernTextBoxStyle}"
                                 ToolTip="在注册表中使用的唯一标识符"/>

                        <!-- 程序路径 -->
                        <Label Content="程序路径：" FontWeight="Medium" Margin="0,15,0,2"/>
    <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox x:Name="PathTextBox" 
                                     Grid.Column="0"
                                     Style="{StaticResource ModernTextBoxStyle}"
                                     ToolTip="要启动的程序的完整路径"/>
                            <Button x:Name="BrowseButton" 
                                    Grid.Column="1"
                                    Content="📁 浏览"
                                    Style="{StaticResource ModernButtonStyle}"
                                    Click="BrowseButton_Click"
                                    Margin="5,0,0,0"/>
                        </Grid>

                        <!-- 应用范围 -->
                        <Label Content="应用范围：" FontWeight="Medium" Margin="0,15,0,2"/>
                        <CheckBox x:Name="ForFilesCheckBox" 
                                  Content="应用于文件（否则应用于目录）"
                                  Margin="0,5"/>

                        <!-- 启用状态 -->
                        <Label Content="状态：" FontWeight="Medium" Margin="0,15,0,2"/>
                        <CheckBox x:Name="EnabledCheckBox" 
                                  Content="启用右键菜单"
                                  Margin="0,5"
                                  Checked="EnabledCheckBox_Checked"
                                  Unchecked="EnabledCheckBox_Unchecked"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- 操作按钮 -->
                <StackPanel Grid.Row="1" 
                           Orientation="Horizontal" 
                           HorizontalAlignment="Right" 
                           Margin="10">
                    <Button x:Name="SaveButton" 
                            Content="💾 保存配置" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="SaveButton_Click"
                            ToolTip="仅保存配置信息，不更新右键菜单"/>
                    <Button x:Name="ApplyButton" 
                            Content="✅ 应用更改" 
                            Style="{StaticResource PrimaryButtonStyle}"
                            Click="ApplyButton_Click"
                            ToolTip="保存配置并更新右键菜单"/>
                    <Button x:Name="TestPathButton" 
                            Content="🔍 测试路径" 
                            Style="{StaticResource ModernButtonStyle}"
                            Click="TestPathButton_Click"/>
                </StackPanel>
            </Grid>
        </GroupBox>
        </Grid>
    </DockPanel>
</Window>
